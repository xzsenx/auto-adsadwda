<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AUTØ — Админ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="admin.css">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>
</head>
<body>

<!-- noise overlay -->
<div class="noise" aria-hidden="true"></div>

<!-- header -->
<header class="topbar">
  <a href="#" class="logo">■ AUTØ <span class="admin-badge">ADMIN</span></a>
  <nav class="nav">
    <a href="index.html">← Каталог</a>
  </nav>
</header>

<!-- auth screen -->
<section class="admin-auth" id="authScreen">
  <div class="auth-box">
    <h2>Вход в панель</h2>
    <p class="muted">Введите пароль администратора</p>
    <input type="password" class="filter-input auth-input" id="passInput" placeholder="Пароль" autocomplete="off">
    <button class="btn btn-primary btn-full" id="btnLogin">Войти</button>
    <p class="auth-error" id="authError"></p>
  </div>
</section>

<!-- admin panel -->
<section class="admin-panel" id="adminPanel" style="display:none">
  <div class="container">

    <!-- tabs -->
    <div class="admin-tabs">
      <button class="admin-tab active" data-tab="cars">Объявления</button>
      <button class="admin-tab" data-tab="stats">Статистика</button>
    </div>

    <!-- TAB: cars -->
    <div class="admin-tab-content" id="tabCars">
      <div class="admin-toolbar">
        <h2>Объявления <span class="pill" id="carsCount">0</span></h2>
        <div class="toolbar-actions">
          <button class="btn btn-sm" id="btnExport">↓ Excel</button>
          <label class="btn btn-sm" id="btnImportLabel">↑ Excel
            <input type="file" id="btnImport" accept=".xlsx,.xls" style="display:none">
          </label>
          <button class="btn btn-sm" id="btnMassPrice">% Цены</button>
          <button class="btn btn-sm" id="btnSelectMode">☐ Выбрать</button>
          <button class="btn btn-primary" id="btnAddCar">+ Добавить</button>
        </div>
      </div>
      <div class="select-bar" id="selectBar" style="display:none">
        <span class="select-bar-info">Выбрано: <strong id="selectCount">0</strong></span>
        <div class="select-bar-actions">
          <button class="btn btn-sm" id="btnSelectAll">Все</button>
          <button class="btn btn-sm" id="btnDeselectAll">Снять</button>
          <button class="btn btn-sm btn-delete" id="btnDeleteSelected">Удалить выбранные</button>
          <button class="btn btn-sm" id="btnCancelSelect">✕ Отмена</button>
        </div>
      </div>
      <div class="admin-list" id="adminList">
        <!-- filled by JS -->
      </div>
    </div>

    <!-- TAB: stats -->
    <div class="admin-tab-content" id="tabStats" style="display:none">
      <div class="admin-toolbar">
        <h2>Статистика</h2>
        <button class="btn btn-sm" id="btnRefreshStats">↻ Обновить</button>
      </div>

      <!-- KPI cards -->
      <div class="stats-kpi-row" id="statsKpi">
        <!-- filled by JS -->
      </div>

      <!-- views chart -->
      <div class="stats-section">
        <h3 class="stats-title">Просмотры за 14 дней</h3>
        <div class="stats-chart" id="statsChart"></div>
      </div>

      <!-- popular cars -->
      <div class="stats-section">
        <h3 class="stats-title">Популярные авто (по просмотрам)</h3>
        <div class="stats-table" id="statsPopular"></div>
      </div>

      <!-- favorites -->
      <div class="stats-section">
        <h3 class="stats-title">Чаще добавляют в избранное</h3>
        <div class="stats-table" id="statsFavs"></div>
      </div>

      <!-- sessions -->
      <div class="stats-section">
        <h3 class="stats-title">Последние посещения</h3>
        <div class="stats-table" id="statsSessions"></div>
      </div>
    </div>

  </div>
</section>

<!-- edit modal -->
<div class="modal-backdrop" id="editBackdrop" aria-hidden="true"></div>
<div class="modal admin-modal" id="editModal" role="dialog" aria-modal="true" aria-hidden="true">
  <button class="btn btn-icon modal-close" id="editClose">✕</button>
  <div class="modal-body">
    <h2 class="modal-title" id="editTitle">Редактирование</h2>
    <form class="admin-form" id="editForm" autocomplete="off">
      <div class="form-group">
        <label class="filter-label">Название</label>
        <input type="text" class="filter-input" name="title" required>
      </div>
      <div class="form-group">
        <label class="filter-label">Цена</label>
        <div class="price-input-wrap">
          <input type="text" class="filter-input" name="price" placeholder="5 250 000" required>
          <span class="price-suffix">₽</span>
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="filter-label">Категория</label>
          <select class="filter-input" name="category">
            <option value="sedan">Седан</option>
            <option value="suv">Кроссовер</option>
            <option value="sport">Спорт</option>
            <option value="business">Бизнес</option>
            <option value="hatchback">Хэтчбек</option>
            <option value="wagon">Универсал</option>
            <option value="minivan">Минивэн</option>
            <option value="pickup">Пикап</option>
            <option value="electric">Электро</option>
          </select>
        </div>
        <div class="form-group">
          <label class="filter-label">Тег</label>
          <select class="filter-input" name="tag">
            <option value="SEDAN">SEDAN</option>
            <option value="SUV">SUV</option>
            <option value="SPORT">SPORT</option>
            <option value="BUSINESS">BUSINESS</option>
            <option value="HATCHBACK">HATCHBACK</option>
            <option value="WAGON">WAGON</option>
            <option value="MINIVAN">MINIVAN</option>
            <option value="PICKUP">PICKUP</option>
            <option value="ELECTRIC">ELECTRIC</option>
            <option value="LIMITED">LIMITED</option>
            <option value="NEW">NEW</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="filter-label">Описание</label>
        <textarea class="filter-input admin-textarea" name="desc" rows="3"></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="filter-label">Год</label>
          <input type="text" class="filter-input" name="year">
        </div>
        <div class="form-group">
          <label class="filter-label">Пробег</label>
          <input type="text" class="filter-input" name="km" placeholder="43 000">
        </div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="filter-label">Двигатель</label>
          <input type="text" class="filter-input" name="engine" placeholder="184 л.с.">
        </div>
        <div class="form-group">
          <label class="filter-label">Привод</label>
          <select class="filter-input" name="drive">
            <option value="">—</option>
            <option value="Полный">Полный</option>
            <option value="Передний">Передний</option>
            <option value="Задний">Задний</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="filter-label">Фото <span class="photo-hint">(перетаскивайте для сортировки)</span></label>
        <input type="file" class="filter-input file-input" name="photo" accept="image/*">
        <div class="photo-preview" id="photoPreview"></div>
      </div>
      <input type="hidden" name="id">
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Сохранить</button>
        <button type="button" class="btn" id="editCancel">Отмена</button>
      </div>
    </form>
  </div>
</div>

<!-- mass price modal -->
<div class="modal-backdrop" id="massPriceBackdrop" aria-hidden="true"></div>
<div class="modal admin-modal confirm-modal" id="massPriceModal" aria-hidden="true">
  <button class="btn btn-icon modal-close" id="massPriceClose">✕</button>
  <div class="modal-body">
    <h2 class="modal-title" style="margin-bottom:16px">Изменение цен</h2>
    <div class="mass-price-form">
      <div class="form-group">
        <label class="filter-label">Действие</label>
        <div class="mass-price-toggle">
          <button class="btn btn-sm mass-toggle active" data-dir="up">↑ Повысить</button>
          <button class="btn btn-sm mass-toggle" data-dir="down">↓ Понизить</button>
        </div>
      </div>
      <div class="form-group">
        <label class="filter-label">Процент</label>
        <div class="price-input-wrap">
          <input type="number" class="filter-input" id="massPricePct" min="1" max="100" value="5" step="1">
          <span class="price-suffix">%</span>
        </div>
      </div>
      <div class="form-group">
        <label class="filter-label">Применить к</label>
        <div class="mass-price-toggle">
          <button class="btn btn-sm mass-scope active" data-scope="all">Все авто</button>
          <button class="btn btn-sm mass-scope" data-scope="selected">Выбранные</button>
        </div>
      </div>
      <div id="massSelectedInfo" class="mass-selected-info" style="display:none">
        Выбрано: <strong id="massSelectedCount">0</strong> авто
      </div>
      <div class="mass-price-preview" id="massPricePreview"></div>
      <div class="form-actions">
        <button class="btn btn-primary" id="massPriceApply">Применить</button>
        <button class="btn" id="massPriceCancel">Отмена</button>
      </div>
    </div>
  </div>
</div>

<!-- confirm dialog -->
<div class="modal-backdrop" id="confirmBackdrop" aria-hidden="true"></div>
<div class="modal admin-modal confirm-modal" id="confirmModal" aria-hidden="true">
  <div class="modal-body confirm-body">
    <h3 id="confirmText">Удалить объявление?</h3>
    <div class="form-actions">
      <button class="btn btn-danger" id="confirmYes">Удалить</button>
      <button class="btn" id="confirmNo">Отмена</button>
    </div>
  </div>
</div>

<script src="admin.js"></script>
</body>
</html>
